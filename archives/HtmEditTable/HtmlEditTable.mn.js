var HtmlEditTable=null;var buttonUp="<td><button id='bt-up' class='bt-up'>↑</button></td>";var buttonDown="<td><button id='bt-down' class='bt-down'>↓</button></td>";var buttonAdd="<td><button id='bt-add' class='bt-add'>+</button></td>";var buttonDel="<td><button id='bt-del' class='bt-del'>-</button></td>";var buttonLeft="<td><button id='bt-left' class='bt-left'>Left</button></td>";var buttonRight="<td><button id='bt-right' class='bt-right'>Right</button></td>";var buttonTete="";Addcolonne(buttonUp);Addcolonne(buttonDown);Addcolonne(buttonAdd);Addcolonne(buttonDel);function nombreItem(){var b=document.getElementById("tableHTML").getElementsByTagName("tr");return LastCellule=document.getElementById("tableHTML").getElementsByTagName("tr")[1].getElementsByTagName("td").length-4}function sauvegarde(){value=tableEdit.AllData2().join(";");prompt(nombreItem()+" items - "+value.length+" octets => "+value)}apiJeedom="w35cb9cmgg2ehbsbca1h";apiVirtual="M60ifHEUrDqIssSbVHGaAfF0FYLKXfQ5";function getSetVar(d,c){return $.get("/core/api/jeeApi.php?apikey="+apiJeedom+"&type=variable&name="+d+'&value="'+c+'"')}function getCmd(b){return $.get("/core/api/jeeApi.php?apikey="+apiJeedom+"&type=cmd&id="+b)}function bt_left(){buttonTete="bt_left"}function bt_right(){buttonTete="bt_right"}function bt_add(){buttonTete="bt_add"}function bt_del(){buttonTete="bt_del"}$("thead").on("click","th",(function(){var r=this,s=r.cellIndex;if(buttonTete=="bt_left"){inverserColonne(s,s-1)}else{if(buttonTete=="bt_right"){inverserColonne(s,s+1)}else{if(buttonTete=="bt_add"){var x=document.getElementById("tableHTML").getElementsByTagName("tr");for(var u=0;u<x.length;u++){var v=x[u].insertCell(s+1);if(u>0){v.innerHTML=" "}else{v.innerHTML="colonne_"+(s+2)+boutonFonctionsColonnes}}}else{if(buttonTete=="bt_del"){var y=document.getElementById("tableHTML");var i=y.rows;var u=s;for(var w=0;w<i.length;w++){i[w].deleteCell(u)}}else{var j=document.getElementById("tableHTML").tHead.rows;var p=j[0].cells;var q=p[s];var z=(q.innerHTML.split("<"))[0];var z=prompt("Donnez le nouveau nom de la colonne '"+z+"'");if(z!=null){q.innerHTML=z+boutonFonctionsColonnes}}}}}buttonTete="";var t=new HtmlEditTable({table:tableHTML})}));$("tbody").on("click","td",(function(){var u=this,B=u.parentNode,p=B.rowIndex,x=u.cellIndex;nbItem=nombreItem();if(x==(nbItem+0)){deplacerLigne(p,p-1)}if(x==(nbItem+1)){deplacerLigne(p,p+2)}if(x==(nbItem+2)){var t=document.getElementById("tableHTML").rows[p];var y=t.cells;var s=y[0].innerHTML;var w="<tr><td>"+s+"</td><td>";var o=document.getElementById("tableHTML").tHead.rows;var q=o[0].cells;for(var v=2,A=(q.length-4);v<A;v++){w+="<td> </td>"}w+=buttonUp+buttonDown+buttonAdd+buttonDel+"</tr>";var r=document.getElementById("tableHTML").insertRow(p);r.innerHTML=w}if(x==(nbItem+3)){document.getElementById("tableHTML").deleteRow(p)}var z=new HtmlEditTable({table:tableHTML})}));function deplacerLigne(j,i){if(i<=0){return}var k=document.getElementById("tableHTML").rows[j];var h=document.getElementById("tableHTML").insertRow(i);var l=k.cells;for(var n=0;n<l.length;n++){h.insertCell(-1).innerHTML+=l[n].innerHTML}document.getElementById("tableHTML").deleteRow(k.rowIndex);var m=new HtmlEditTable({table:tableHTML})}function inverserColonne(j,l){var b=document.getElementById("tableHTML");var i;for(var k=0;k<b.rows.length;k++){i=b.rows[k].cells[j].innerHTML;b.rows[k].cells[j].innerHTML=b.rows[k].cells[l].innerHTML;b.rows[k].cells[l].innerHTML=i}var a=new HtmlEditTable({table:tableHTML})}function Addcolonne(j){var i=document.getElementById("tableHTML").getElementsByTagName("tr");var f=document.getElementById("tableHTML").getElementsByTagName("tr")[1].getElementsByTagName("td").length;for(var g=1;g<i.length;g++){var h=i[g].insertCell(f);h.innerHTML=j}}(function(){var b=(function(){var a;function f(c){return Array.prototype.slice.call(document.querySelectorAll(c))}function g(c){var m=c.target;a=m.value.toLocaleLowerCase();var n=m.getAttribute("data-table")+" tbody tr";var d=f(n);[].forEach.call(d,h);var e=m.getAttribute("data-count");if(e){var l=d.reduce(function(i,j){return i+(j.style.display==="none"?0:1)},0);f(e)[0].textContent=l}}function h(c){if(c.lowerTextContent===undefined){c.lowerTextContent=c.textContent.toLocaleLowerCase()}c.style.display=c.lowerTextContent.indexOf(a)===-1?"none":"table-row"}return{init:function(){var c=f("input[data-table]");[].forEach.call(c,function(d){d.oninput=g;if(d.value===""){d.oninput({target:d})}})}}})();document.addEventListener("readystatechange",function(){if(document.readyState==="complete"){b.init()}});b.init()})();(function(){HtmlEditTable=function(){if(arguments.length>0&&arguments[0].table){this.Transform(arguments)}else{this.control=document.createElement("table");if(arguments.length>0){this.Build(arguments[0])}}this.control.cellSpacing=0;this.control.cellPadding=0;this.control.className="HtmlEditTable";this.activeCell=null};HtmlEditTable.prototype={Transform:function(i){this.columns=[];this.lines=[];this.headers=[];this.control=i[0].table;this.caption=this.control.caption;for(var j=0,t=this.control.rows[0].cells.length;j<t;j++){this.columns.push(""+j)}for(var j=0,t=this.control.rows.length;j<t;j++){this.lines.push(""+j)}if(this.control&&this.control.tBodies){for(var j=0,t=this.control.tBodies.length;j<t;j++){var d=this.control.tBodies[j];for(var k=0,v=d.rows.length;k<v;k++){for(var s=0,c=d.rows[k].cells.length;s<c;s++){var b=d.rows[k].cells[s];b.tabIndex=0;f.CellInitialize(this,b);if(b.childNodes.length==0){b.appendChild(document.createTextNode(""))}}}}}if(this.control){e.RemoveTextNode(this.control);if(this.control.tHead){var a=this.control.tHead;e.RemoveTextNode(a);for(var j=0,t=a.rows.length;j<t;j++){e.RemoveTextNode(a.rows[j])}}if(this.control.tBodies){for(var j=0,t=this.control.tBodies.length;j<t;j++){var d=this.control.tBodies[j];e.RemoveTextNode(d);for(var k=0,v=d.rows.length;k<v;k++){e.RemoveTextNode(d.rows[k])}}}if(this.control.tFoot){var u=this.control.tFoot;e.RemoveTextNode(u);for(var j=0,t=u.rows.length;j<t;j++){e.RemoveTextNode(u.rows[j])}}}},Build:function(){if(arguments.length>0){this.Clean();var a=arguments[0];this.Dimensions(a);if(a.Xn){this.columns=a.Xn}if(a.Yn){this.lines=a.Yn}if(a.head){this.headers=a.head}if(a.caption){this.caption=a.caption}if(a.data){this.Populate(a.data)}else{this.Populate()}}},Clean:function(){e.Purge(this.control);this.columns=[];this.lines=[];this.headers=[];this.caption=""},Dimensions:function(){if(arguments.length>0){this.columns=[];this.lines=[];if(arguments[0].X){for(var a=0,b=arguments[0].X;a<b;a++){this.columns.push(""+a)}}if(arguments[0].Y){for(var a=0,b=arguments[0].Y;a<b;a++){this.lines.push(""+a)}}}return{x:this.columns.length,y:this.lines.length}},Populate:function(){if(this.caption){this.control.createCaption().appendChild(document.createTextNode(this.caption))}if(this.lines.length>0){for(var c=0,a=this.lines.length;c<a;c++){var b=this.control.insertRow(c);if(this.columns.length>0){for(var j=0,p=this.columns.length;j<p;j++){var o=b.insertCell(j);if(arguments.length>0){o.tabIndex=0;f.CellInitialize(this,o,arguments[0][j+c*p])}}}}}if(this.headers.length==this.columns.length){var d=this.control.createTHead();var b=d.insertRow(0);for(var c=0,i=this.headers.length;c<i;c++){var o=b.insertCell(c);o.appendChild(document.createTextNode(this.headers[c]))}}},AppendTo:function(a){a.appendChild(this.control)},AllData:function(){var b=[];var c=this.control.tBodies[0].rows;for(var a=0,m=c.length;a<m;a++){var d=c[a].cells;for(var n=0,l=d.length;n<l;n++){b.push(d[n].firstChild.data)}}return b},AllData2:function(){var b=[];var c=this.control.tHead.rows;for(var a=0,m=c.length;a<m;a++){b.push("|");var d=c[a].cells;for(var n=0,l=d.length-4;n<l;n++){b.push(d[n].firstChild.data)}}var c=this.control.tBodies[0].rows;for(var a=0,m=c.length;a<m;a++){b.push("|");var d=c[a].cells;for(var n=0,l=d.length-4;n<l;n++){b.push(d[n].firstChild.data)}}return b},LineNames:function(){if(arguments.length>0){this.lines=lines}return this.lines},ColumnNames:function(){if(arguments.length>0){this.columns=columns}return this.columns},Line:function(){if(arguments.length==0||typeof arguments[0].name=="undefined"){return undefined}var s=[];var i=e.IndexOf(this.lines,arguments[0].name);if(i>-1){var b=this.control.tBodies[0].rows[i].cells;if(typeof arguments[0].data!="undefined"){s=arguments[0].data;for(var r=0,u=s.length;r<u;r++){b[r].firstChild.data=s[r]}}else{for(var d=0,j=b.length;d<j;d++){s.push(b[d].firstChild.data)}}}else{if(typeof arguments[0].data!="undefined"){this.lines.push(arguments[0].name);s=arguments[0].data;var a=this.control.insertRow(-1);for(var t=0,v=this.columns.length;t<v;t++){var c=a.insertCell(-1);c.tabIndex=0;f.CellInitialize(this,c,s[t])}}}return s},Column:function(){if(arguments.length==0||typeof arguments[0].name=="undefined"){return undefined}var r=[];var a=this.control.tBodies[0].rows;var c=e.IndexOf(this.columns,arguments[0].name);if(c>-1){if(typeof arguments[0].data!="undefined"){r=arguments[0].data;for(var q,s=r.length;q<s;q++){a[q].cells[c].firstChild.data=r[q]}}else{this.lines.push(arguments[0].name);for(var i=0,t=a.length;i<t;i++){r.push(a[i].cells[c].firstChild.data)}}}else{if(typeof arguments[0].data!="undefined"){this.columns.push(arguments[0].name);r=arguments[0].data;for(var i=0,t=a.length;i<t;i++){var b=a[i].insertCell(-1);b.tabIndex=0;f.CellInitialize(this,b,r[i])}var p=this.control.getElementsByTagName("thead");if(p.length>0){p=p[0];var d=typeof arguments[0].head!="undefined"?arguments[0].head:"";var b=p.rows[0].insertCell(-1);b.appendChild(document.createTextNode(d))}}}return r},Data:function(c,d,b){if(arguments.length<2){return undefined}var j,a;j=e.IndexOf(this.columns,arguments[0]);if(j>-1){a=e.IndexOf(this.lines,arguments[1]);if(a>-1){if(arguments.length>2){this.control.rows[a].cells[j].appendChild(document.createTextNode(arguments[2]))}return this.control.rows[a].cells[j].firstChild.data}}return undefined},ActiveCellChange:function(b,a){if(this.activeCell){this.activeCell.className=null}this.activeCell=b;if(b){this.activeCell.className="activeCell";if(a){this.activeCell.focus()}}}};var g=function(a){var c=function(n){var m=e.Target(n);var p=e.Node(m,"TD");var o=p.grid;e.Purge(p);f.CellInitialize(o,p,m.value);p.focus()};var b=function(n){var m=e.Target(n);var p=e.Node(m,"TD");var o=p.grid;e.Purge(p);f.CellInitialize(o,p,m.initialValue);p.focus()};var d=function(p){var t=e.Target(p);var s=e.Node(t,"TD");var r=e.SpecialKeys(p).ShiftKey;var o=r?s.parentNode.previousSibling:s.parentNode.nextSibling;c(p);if(o){s=o.cells[s.cellIndex];s.grid.ActiveCellChange(s,true);var q=new g(s.firstChild.data);q.AppendTo(s)}else{o=s.parentNode;tBody=o.parentNode;if(r&&s.cellIndex>0){o=tBody.lastChild;s=o.cells[s.cellIndex-1];s.grid.ActiveCellChange(s,true);var q=new g(s.firstChild.data);q.AppendTo(s)}else{if(!r&&o.cells.length-1>s.cellIndex){o=tBody.firstChild;s=o.cells[s.cellIndex+1];s.grid.ActiveCellChange(s,true);var q=new g(s.firstChild.data);q.AppendTo(s)}}}};this.control=document.createElement("input");this.control.type="text";this.control.className="HtmlEdit";this.control.onblur=c;this.control.onkeydown=function(j){switch(e.KeyCode(j)){case h.RETURN:c(j);break;case h.ESCAPE:b(j);break;case h.TAB:d(j);break}};this.control.value=a;this.control.initialValue=a};g.prototype={AppendTo:function(a){if(document.all){this.control.style.height=a.clientHeight-2*a.clientTop+"px";this.control.style.width=a.clientWidth-2*a.clientLeft+"px"}else{this.control.style.height=a.offsetHeight-2*a.clientTop+"px";this.control.style.width=a.offsetWidth-2*a.clientLeft+"px"}e.Purge(a);f.CellNeutralizeEvents(a);a.appendChild(this.control);this.control.select();this.control.focus()}};var f={CellInitialize:function(b,c,a){if(c){c.grid=b;c.onclick=f.ClickHandler;c.ondblclick=f.DblClickHandler;c.onkeydown=f.KeydownHandler;if(typeof a!="undefined"){c.appendChild(document.createTextNode(a))}}},CellNeutralizeEvents:function(a){if(a){a.onclick=null;a.ondblclick=null;a.onkeydown=null}},KeydownHandler:function(c){var b=e.Node(e.Target(c),"TD");if(!b){e.Event(c).returnValue=false;return false}var d=function(i){i.firstChild.data=""};var q=function(i){i=e.Node(i.previousSibling,"TD");if(i){i.grid.ActiveCellChange(i,true)}};var n=function(i){i=e.Node(i.nextSibling,"TD");if(i){i.grid.ActiveCellChange(i,true)}};var o=function(i){var j=i.parentNode.previousSibling;if(j){i=j.cells[i.cellIndex];i.grid.ActiveCellChange(i,true)}};var p=function(i){var j=i.parentNode.nextSibling;if(j){i=j.cells[i.cellIndex];i.grid.ActiveCellChange(i,true)}};var a=function(i){var k=e.SpecialKeys(c).ShiftKey;var j=k?i.parentNode.previousSibling:i.parentNode.nextSibling;if(j){i=j.cells[i.cellIndex];i.grid.ActiveCellChange(i,true)}else{j=i.parentNode;tBody=j.parentNode;if(k&&i.cellIndex>0){j=tBody.lastChild;i=j.cells[i.cellIndex-1];i.grid.ActiveCellChange(i,true)}if(!k&&j.cells.length-1>i.cellIndex){j=tBody.firstChild;i=j.cells[i.cellIndex+1];i.grid.ActiveCellChange(i,true)}}};switch(e.KeyCode(c)){case h.RETURN:f.DblClickHandler(c);break;case h.DELETE:d(b);break;case h.LEFT:q(b);break;case h.UP:o(b);break;case h.RIGHT:n(b);break;case h.DOWN:p(b);break;case h.TAB:a(b);break}returnValue=false;return false},DblClickHandler:function(b){var a=e.Node(e.Target(b),"TD");if(!a){e.Event(b).returnValue=false;return false}var c=new g(a.firstChild.data);c.AppendTo(a);a.grid.ActiveCellChange(a,false)},ClickHandler:function(b){var a=e.Node(e.Target(b),"TD");if(!a){e.Event(b).returnValue=false;return false}a.grid.ActiveCellChange(a,true)}};var e={Purge:function(c){while(c&&c.hasChildNodes()){var a=c.firstChild;e.Purge(a);var l=a.attributes;if(l){var b;var i=l.length;for(var d=0;d<i;d++){b=l[d].name;if(typeof a[b]==="function"){a[b]=null}}}a=null;c.removeChild(c.firstChild)}},Node:function(b,a){while(b&&b.nodeName!=a.toUpperCase()){b=b.parentNode}if(b){return b}return undefined},Event:function(a){return window.event||a},Target:function(a){a=e.Event(a);return a.srcElement||a.target},KeyCode:function(a){a=e.Event(a);return a.keyCode||a.which},IndexOf:function(a,b){for(var c=0,d=a.length;c<d;c++){if(c in a&&a[c]===b){return c}}return -1},RemoveTextNode:function(b){if(b==null){return}for(var c=b.childNodes.length-1;c>-1;c--){var a=b.childNodes[c];if(a.nodeName=="#text"){b.removeChild(a)}}},SpecialKeys:function(a){if(a.modifiers){var b=(a.modifiers+32).toString(2).substring(3,6);return{ShiftKey:b.charAt(0)=="1",CtrlKey:b.charAt(1)=="1",AltKey:b.charAt(2)=="1"}}else{return{ShiftKey:a.shiftKey,CtrlKey:a.ctrlKey,AltKey:a.altKey}}}};var h={BACKSPACE:8,TAB:9,RETURN:13,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46}})();