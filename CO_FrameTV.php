<?php
/**********************************************************************************************************************
FrameTV - 187

Gère le ON/Off de la Frame TV selon la présence dans le salon et NuitSalon

**********************************************************************************************************************/
// Infos, Commandes et Equipements :
	// $infCinema

// N° des scénarios :

//Variables :
	$nuitSalon = mg::getVar('NuitSalon');
	$lastMvmt = round(mg::lastMvmt($infMvmt, $nbMvmt)/60);
	$cinema = mg::getCmd($infCinema);

// Paramètres :
	$timingFrameTV = mg::getParam('Confort', 'timingFrameTV');

/*********************************************************************************************************************/
/*********************************************************************************************************************/
/*********************************************************************************************************************/
mg::setCron('', time() + $timingFrameTV*60);

if ($nuitSalon != 2 && $nbMvmt) {
	// =================================================================================================================
	mg::MessageT('', "! ALLUMAGE TV - lastMvmt : $lastMvmt");
	//=================================================================================================================
	mg::frameTV('Frame TV', 'Salon', 'on');
	
} elseif (!$cinema && ($nuitSalon == 2 || $lastMvmt > $timingFrameTV)) {
	//=================================================================================================================
	mg::MessageT('', "! ARRET DE LA TV - lastMvmt : $lastMvmt");
	//=================================================================================================================
	mg::frameTV('Frame TV', 'Salon', 'off');
}

?>